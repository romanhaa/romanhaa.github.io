<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="generator" content="Hugo 0.62.2" />
  
  <title>Roman Hillje - Data Visualization &amp; Bioinformatics</title>
  
  
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i">
  <link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css"/>
  <link rel="stylesheet" href="/css/medium.css">
</head>
<body><nav class="navbar navbar-expand-lg navbar-light bg-white mediumnavigation nav-down navbar-static-top">
  <div class="container pr-0">

    
    <a class="navbar-brand" href="http://romanhaa.github.io/">
      
      <span style="font-family:Righteous;">Roman Hillje - Data Visualization &amp; Bioinformatics</span>
      
    </a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    
    <div class="collapse navbar-collapse" id="navbarMediumish">
      
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item ">
          <a class="nav-link" href="/">About Me</a>
        </li>
        
        <li class="nav-item ">
          <a class="nav-link" href="/projects">Projects</a>
        </li>
        
        <li class="nav-item ">
          <a class="nav-link" href="/plots">Plot Gallery</a>
        </li>
        
        <li class="nav-item ">
          <a class="nav-link" href="/blog">Blog</a>
        </li>
        
      </ul>
    </div>

  </div>
</nav>
<div class="site-content">
      <div class="container">
  <link rel="stylesheet" href="/css/numbered_headers.css">
  
  <div class="main-content">
    
    <div class="container">
      <div class="row">
        
        <div class="col-sm-3">
          <nav id="toc" class="sticky-top" style="padding-top: 50px;"></nav>
        </div>
        <div class="col-sm-9">
        
          <div class="mainheading">
            
            <h1 class="posttitle">Visualizing health data</h1>
            <div class="article-post">
              Last update: Feb 9, 2020
            </div>
          </div>
          
          
            <img class="featured-image img-fluid" src="/images/projects/health_data/title.png" alt="thumbnail for this post">
          
          
          <body>
            <div class="article-post">
              <p>The goal is to visualize several types of health data, e.g. recorded by a Xiaomi Mi Band (in this case model 4).</p>
<h2 id="data-sources">Data sources</h2>
<p>I collect the following data:</p>
<ul>
<li>Heart rate (once per minute), steps, and sleep data are collected by a Xiaomi Mi Band 4. The data is synched to the Mi Fit app and from the transferred to and exported from the Apple Health app.</li>
<li>Workout sessions are recorded by Streaks Workout. The data can be exported to a <code>.csv</code> file from Streaks Workout app itself.</li>
<li>Running sessions are recorded by Strava. Data can be downloaded from the Strava website as a <code>.gpx</code> file.</li>
</ul>
<h2 id="preparation">Preparation</h2>
<h3 id="load-packages">Load packages</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r"><span style="color:#900;font-weight:bold">library</span>(tidyverse)
<span style="color:#900;font-weight:bold">library</span>(lubridate)
<span style="color:#900;font-weight:bold">library</span>(XML)
<span style="color:#900;font-weight:bold">library</span>(viridis)
</code></pre></div><h3 id="load-data">Load data</h3>
<p>As mentioned before, heart rate, steps and sleep data are synced from the Mi Fi app to Apple Health and from there we export it.
Depending on the amount of data that is stored in Apple Health, these files can become quite large.
The data we want to import is stored in the <code>export.xml</code> file, which we will load using the <code>XML::xmlParse()</code> function.
Then, we transform it into a tibble using the <code>XML::xmlAttrsToDataFrame()</code> function.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r">xml <span style="color:#000;font-weight:bold">&lt;-</span> XML<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">xmlParse</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">export.xml&#39;</span>)
data <span style="color:#000;font-weight:bold">&lt;-</span> XML<span style="color:#000;font-weight:bold">:::</span><span style="color:#900;font-weight:bold">xmlAttrsToDataFrame</span>(xml[<span style="color:#d14">&#39;</span><span style="color:#d14">//Record&#39;</span>]) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">as_tibble</span>()
</code></pre></div><p>We also export my workout sessions which I recorded with <a href="https://streaksworkout.com">Streaks Workout</a>.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r">workouts <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">read_csv</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">streaks-workout.csv&#39;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">filter</span>(<span style="color:#000;font-weight:bold">!</span><span style="color:#900;font-weight:bold">is.na</span>(device_name)) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">mutate</span>(
    date <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">format</span>(starting_time, <span style="color:#d14">&#39;</span><span style="color:#d14">%Y-%m-%d&#39;</span>),
    dayofweek <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">wday</span>(starting_time, label <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">TRUE</span>, abbr <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">FALSE</span>),
    date_and_day <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">paste0</span>(date, <span style="color:#d14">&#39;</span><span style="color:#d14"> (&#39;</span>, dayofweek, <span style="color:#d14">&#39;</span><span style="color:#d14">)&#39;</span>)
  )
</code></pre></div><h2 id="heart-rate">Heart rate</h2>
<p>Ideally, my heart rate is recorded once a minute.
However, there are some missing values because sometimes the band is placed in a way that it can't measure the heart rate.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r">data_heart_rate <span style="color:#000;font-weight:bold">&lt;-</span> data <span style="color:#000;font-weight:bold">%&gt;%</span>
  dplyr<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">filter</span>(
    type <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;</span><span style="color:#d14">HKQuantityTypeIdentifierHeartRate&#39;</span>,
    sourceName <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Mi Fit&#39;</span>
  ) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">mutate</span>(
    creationDate <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">ymd_hms</span>(creationDate, tz <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Europe/Amsterdam&#39;</span>),
    startDate <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">ymd_hms</span>(startDate, tz <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Europe/Amsterdam&#39;</span>),
    endDate <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">ymd_hms</span>(endDate, tz <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Europe/Amsterdam&#39;</span>),
    date <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">format</span>(endDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%Y-%m-%d&#39;</span>),
    dayofweek <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">wday</span>(endDate, label <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">TRUE</span>, abbr <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">FALSE</span>),
    date_and_day <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">paste0</span>(date, <span style="color:#d14">&#39;</span><span style="color:#d14"> (&#39;</span>, dayofweek, <span style="color:#d14">&#39;</span><span style="color:#d14">)&#39;</span>),
    hour_minute <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">as.integer</span>(<span style="color:#900;font-weight:bold">format</span>(endDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%H&#39;</span>)) <span style="color:#000;font-weight:bold">+</span> <span style="color:#900;font-weight:bold">as.integer</span>(<span style="color:#900;font-weight:bold">format</span>(endDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%M&#39;</span>))<span style="color:#000;font-weight:bold">/</span><span style="color:#099">60</span>,
    value <span style="color:#000;font-weight:bold">=</span> value <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">as.character</span>() <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">as.numeric</span>()
  )
</code></pre></div><h3 id="profile-over-the-day">Profile over the day</h3>
<p>We use different values for <code>k</code> in the <code>geom_smooth()</code> call to control how smooth the line of the GAM should be.
Workout sessions are marked as grey areas.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r">p <span style="color:#000;font-weight:bold">&lt;-</span> data_heart_rate <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">filter</span>(date <span style="color:#000;font-weight:bold">%in%</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">2020-01-25&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">2020-02-07&#39;</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">ggplot</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_rect</span>(
    data <span style="color:#000;font-weight:bold">=</span> workouts <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(date <span style="color:#000;font-weight:bold">%in%</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">2020-01-25&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">2020-02-07&#39;</span>)),
    <span style="color:#900;font-weight:bold">aes</span>(xmin <span style="color:#000;font-weight:bold">=</span> starting_time, xmax <span style="color:#000;font-weight:bold">=</span> finishing_time, ymin <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#000;font-weight:bold">Inf</span>, ymax <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Inf</span>),
    fill <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;</span><span style="color:#d14">grey&#34;</span>, alpha <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.5</span>
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_line</span>(<span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> endDate, y <span style="color:#000;font-weight:bold">=</span> value), size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.5</span>, color <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">grey&#39;</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_point</span>(<span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> endDate, y <span style="color:#000;font-weight:bold">=</span> value, color <span style="color:#000;font-weight:bold">=</span> value), size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.5</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_color_viridis</span>(option <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">magma&#39;</span>, direction <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">-1</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_y_continuous</span>(name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Heart rate [BPM]&#39;</span>, limits <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">40</span>,<span style="color:#099">160</span>)) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme_bw</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme</span>(
    axis.title.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
    legend.position <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">none&#39;</span>,
    strip.text.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_text</span>(face <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">bold&#39;</span>)
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">facet_wrap</span>(<span style="color:#000;font-weight:bold">~</span>date_and_day, ncol <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>, scales <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">free_x&#39;</span>)
<span style="color:#900;font-weight:bold">ggsave</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">heart_rate_profile_day.png&#39;</span>, p, height <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">7</span>, width <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">8</span>)
</code></pre></div>
<figure >
  
    <img src="/images/projects/health_data/heart_rate_profile_day.png"  style="width: 100%;" />
  
  
</figure>


<p>Some measurements look like outliers.
We can deal with that by applying a smoothing line with different <code>k</code> parameter to control how sensitive it should be.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r">p <span style="color:#000;font-weight:bold">&lt;-</span> data_heart_rate <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">filter</span>(date <span style="color:#000;font-weight:bold">%in%</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">2020-01-25&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">2020-02-07&#39;</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">ggplot</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_rect</span>(
    data <span style="color:#000;font-weight:bold">=</span> workouts <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(date <span style="color:#000;font-weight:bold">%in%</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">2020-01-25&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">2020-02-07&#39;</span>)),
    <span style="color:#900;font-weight:bold">aes</span>(xmin <span style="color:#000;font-weight:bold">=</span> starting_time, xmax <span style="color:#000;font-weight:bold">=</span> finishing_time, ymin <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#000;font-weight:bold">Inf</span>, ymax <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Inf</span>),
    fill <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;</span><span style="color:#d14">grey&#34;</span>, alpha <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.5</span>
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_point</span>(<span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> endDate, y <span style="color:#000;font-weight:bold">=</span> value), color <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">grey&#39;</span>, size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.5</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_smooth</span>(<span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> endDate, y <span style="color:#000;font-weight:bold">=</span> value, color <span style="color:#000;font-weight:bold">=</span> ..y..), method <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">gam&#39;</span>, formula <span style="color:#000;font-weight:bold">=</span> y <span style="color:#000;font-weight:bold">~</span> <span style="color:#900;font-weight:bold">s</span>(x, k <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">20</span>), size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_smooth</span>(<span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> endDate, y <span style="color:#000;font-weight:bold">=</span> value, color <span style="color:#000;font-weight:bold">=</span> ..y..), method <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">gam&#39;</span>, formula <span style="color:#000;font-weight:bold">=</span> y <span style="color:#000;font-weight:bold">~</span> <span style="color:#900;font-weight:bold">s</span>(x, k <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">50</span>), size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_smooth</span>(<span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> endDate, y <span style="color:#000;font-weight:bold">=</span> value, color <span style="color:#000;font-weight:bold">=</span> ..y..), method <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">gam&#39;</span>, formula <span style="color:#000;font-weight:bold">=</span> y <span style="color:#000;font-weight:bold">~</span> <span style="color:#900;font-weight:bold">s</span>(x, k <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">100</span>), size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_color_viridis</span>(option <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">magma&#39;</span>, direction <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">-1</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_y_continuous</span>(name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Heart rate [BPM]&#39;</span>, limits <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">40</span>,<span style="color:#099">160</span>)) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme_bw</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme</span>(
    axis.title.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
    legend.position <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">none&#39;</span>,
    strip.text.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_text</span>(face <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">bold&#39;</span>)
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">facet_wrap</span>(<span style="color:#000;font-weight:bold">~</span>date_and_day, ncol <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>, scales <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">free_x&#39;</span>)
<span style="color:#900;font-weight:bold">ggsave</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">heart_rate_profile_day_smooth.png&#39;</span>, p, height <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">7</span>, width <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">8</span>)
</code></pre></div>
<figure >
  
    <img src="/images/projects/health_data/heart_rate_profile_day_smooth.png"  style="width: 100%;" />
  
  
</figure>


<h3 id="heatmap">Heatmap</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r">p <span style="color:#000;font-weight:bold">&lt;-</span> data_heart_rate <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">filter</span>(<span style="color:#900;font-weight:bold">grepl</span>(date, pattern <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">2020-02&#39;</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">ggplot</span>(<span style="color:#900;font-weight:bold">aes</span>(hour_minute, <span style="color:#900;font-weight:bold">reorder</span>(date, <span style="color:#900;font-weight:bold">desc</span>(date)))) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_tile</span>(<span style="color:#900;font-weight:bold">aes</span>(fill <span style="color:#000;font-weight:bold">=</span> value)) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_x_continuous</span>(breaks <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">seq</span>(<span style="color:#099">0</span>, <span style="color:#099">23</span>, by <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>), expand <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0.01</span>, <span style="color:#099">0</span>)) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_fill_viridis</span>(
    option <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">magma&#39;</span>, direction <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">-1</span>, na.value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">white&#39;</span>,
    guide <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">guide_colorbar</span>(frame.colour <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">black&#39;</span>, ticks.colour <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">black&#39;</span>)
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">labs</span>(x <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Time&#39;</span>, y <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">&#39;</span>, fill <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">BPM&#39;</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme_bw</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme</span>(
    panel.grid.major.y <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
    panel.grid.minor.y <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>()
  )
<span style="color:#900;font-weight:bold">ggsave</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">heart_rate_heatmap.png&#39;</span>, p, height <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>, width <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">9</span>)
</code></pre></div>
<figure >
  
    <img src="/images/projects/health_data/heart_rate_heatmap.png"  style="width: 100%;" />
  
  
</figure>


<h2 id="sleep-stats">Sleep stats</h2>
<p>To show sleeping blocks, we need to do some extra parsing.
With this technique, we cut the day into two parts: The part before 18:00, and the part after 18:00.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r">data_sleep <span style="color:#000;font-weight:bold">&lt;-</span> data <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">filter</span>(
    type <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;</span><span style="color:#d14">HKCategoryTypeIdentifierSleepAnalysis&#39;</span>,
    sourceName <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Mi Fit&#39;</span>
  ) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">mutate</span>(
    creationDate <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">ymd_hms</span>(creationDate, tz <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Europe/Amsterdam&#39;</span>),
    startDate <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">ymd_hms</span>(startDate, tz <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Europe/Amsterdam&#39;</span>),
    start_hour_minute <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">ifelse</span>(
      <span style="color:#900;font-weight:bold">format</span>(startDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%H&#39;</span>) <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">18</span>,
      <span style="color:#900;font-weight:bold">as.integer</span>(<span style="color:#900;font-weight:bold">format</span>(startDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%H&#39;</span>)) <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">18</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#900;font-weight:bold">as.integer</span>(<span style="color:#900;font-weight:bold">format</span>(startDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%M&#39;</span>))<span style="color:#000;font-weight:bold">/</span><span style="color:#099">60</span>,
      <span style="color:#900;font-weight:bold">as.integer</span>(<span style="color:#900;font-weight:bold">format</span>(startDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%H&#39;</span>)) <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">6</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#900;font-weight:bold">as.integer</span>(<span style="color:#900;font-weight:bold">format</span>(startDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%M&#39;</span>))<span style="color:#000;font-weight:bold">/</span><span style="color:#099">60</span>
    ),
    endDate <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">ymd_hms</span>(endDate, tz <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Europe/Amsterdam&#39;</span>),
    end_date <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">format</span>(endDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%Y-%m-%d&#39;</span>),
    end_hour_minute <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">ifelse</span>(
      <span style="color:#900;font-weight:bold">format</span>(endDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%H&#39;</span>) <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">18</span>,
      <span style="color:#900;font-weight:bold">as.integer</span>(<span style="color:#900;font-weight:bold">format</span>(endDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%H&#39;</span>)) <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">18</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#900;font-weight:bold">as.integer</span>(<span style="color:#900;font-weight:bold">format</span>(endDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%M&#39;</span>))<span style="color:#000;font-weight:bold">/</span><span style="color:#099">60</span>,
      <span style="color:#900;font-weight:bold">as.integer</span>(<span style="color:#900;font-weight:bold">format</span>(endDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%H&#39;</span>)) <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">6</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#900;font-weight:bold">as.integer</span>(<span style="color:#900;font-weight:bold">format</span>(endDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%M&#39;</span>))<span style="color:#000;font-weight:bold">/</span><span style="color:#099">60</span>
    )
  ) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">arrange</span>(startDate)

data_sleep<span style="color:#000;font-weight:bold">$</span>night <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#d14">&#39;</span><span style="color:#d14">1&#39;</span>

<span style="color:#900;font-weight:bold">for </span>( i in <span style="color:#099">2</span><span style="color:#000;font-weight:bold">:</span><span style="color:#900;font-weight:bold">nrow</span>(data_sleep) ) {
  <span style="color:#900;font-weight:bold">if </span>( <span style="color:#900;font-weight:bold">difftime</span>(data_sleep<span style="color:#000;font-weight:bold">$</span>startDate[i], data_sleep<span style="color:#000;font-weight:bold">$</span>endDate[i<span style="color:#099">-1</span>], units <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">hours&#39;</span>) <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">2</span> ) {
    data_sleep<span style="color:#000;font-weight:bold">$</span>night[i] <span style="color:#000;font-weight:bold">&lt;-</span> data_sleep<span style="color:#000;font-weight:bold">$</span>night[i<span style="color:#099">-1</span>]
  } else {
    data_sleep<span style="color:#000;font-weight:bold">$</span>night[i] <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">as.character</span>(<span style="color:#900;font-weight:bold">as.integer</span>(data_sleep<span style="color:#000;font-weight:bold">$</span>night[i<span style="color:#099">-1</span>]) <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>)
  }
}
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r">p <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">ggplot</span>(data_sleep) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_rect</span>(
    <span style="color:#900;font-weight:bold">aes</span>(
      xmin <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">as.integer</span>(night) <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">0.45</span>,
      xmax <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">as.integer</span>(night) <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">0.45</span>,
      ymin <span style="color:#000;font-weight:bold">=</span> start_hour_minute,
      ymax <span style="color:#000;font-weight:bold">=</span> end_hour_minute
    )
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_x_continuous</span>(
    limits <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span>, data_sleep<span style="color:#000;font-weight:bold">$</span>end_date <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">unique</span>() <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">length</span>()),
    breaks <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">seq</span>(<span style="color:#099">1</span>, data_sleep<span style="color:#000;font-weight:bold">$</span>end_date <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">unique</span>() <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">length</span>(), <span style="color:#099">1</span>),
    labels <span style="color:#000;font-weight:bold">=</span> data_sleep<span style="color:#000;font-weight:bold">$</span>end_date <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">unique</span>(),
    expand <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0.01</span>,<span style="color:#099">0</span>)
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_y_continuous</span>(
    limits <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0</span>, <span style="color:#099">24</span>), breaks <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">seq</span>(<span style="color:#099">0</span>, <span style="color:#099">24</span>, <span style="color:#099">2</span>),
    labels <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">18:00&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">20:00&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">22:00&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">00:00&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">02:00&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">04:00&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">06:00&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">08:00&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">10:00&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">12:00&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">14:00&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">16:00&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">18:00&#39;</span>)
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme_bw</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme</span>(
    axis.title <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
    panel.grid.major.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
    panel.grid.minor.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
    axis.text.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_text</span>(angle <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">45</span>, hjust <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>)
  )
<span style="color:#900;font-weight:bold">ggsave</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">sleep_by_night.png&#39;</span>, p, height <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">5</span>, width <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">12</span>)
</code></pre></div>
<figure >
  
    <img src="/images/projects/health_data/sleep_by_night.png"  style="width: 100%;" />
  
  
</figure>


<h2 id="steps">Steps</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r">data_steps <span style="color:#000;font-weight:bold">&lt;-</span> data <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">filter</span>(
    type <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;</span><span style="color:#d14">HKQuantityTypeIdentifierStepCount&#39;</span>,
    sourceName <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Mi Fit&#39;</span>
  ) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">mutate</span>(
    value <span style="color:#000;font-weight:bold">=</span> value <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">as.character</span>() <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">as.numeric</span>(),
    creationDate <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">ymd_hms</span>(creationDate, tz <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Europe/Amsterdam&#39;</span>),
    startDate <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">ymd_hms</span>(startDate, tz <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Europe/Amsterdam&#39;</span>),
    start_date <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">format</span>(startDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%Y-%m-%d&#39;</span>),
    start_hour_minute <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">as.integer</span>(<span style="color:#900;font-weight:bold">format</span>(startDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%H&#39;</span>)) <span style="color:#000;font-weight:bold">+</span> <span style="color:#900;font-weight:bold">as.integer</span>(<span style="color:#900;font-weight:bold">format</span>(startDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%M&#39;</span>))<span style="color:#000;font-weight:bold">/</span><span style="color:#099">60</span>,
    endDate <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">ymd_hms</span>(endDate, tz <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Europe/Amsterdam&#39;</span>),
    end_date <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">format</span>(endDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%Y-%m-%d&#39;</span>),
    end_hour_minute <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">as.integer</span>(<span style="color:#900;font-weight:bold">format</span>(endDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%H&#39;</span>)) <span style="color:#000;font-weight:bold">+</span> <span style="color:#900;font-weight:bold">as.integer</span>(<span style="color:#900;font-weight:bold">format</span>(endDate, <span style="color:#d14">&#39;</span><span style="color:#d14">%M&#39;</span>))<span style="color:#000;font-weight:bold">/</span><span style="color:#099">60</span>
  ) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">arrange</span>(startDate)
</code></pre></div><h3 id="total-steps-per-day">Total steps per day</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r">p <span style="color:#000;font-weight:bold">&lt;-</span> data_steps <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">arrange</span>(startDate) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">group_by</span>(start_date) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">summarize</span>(total_steps <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">sum</span>(value)) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">ggplot</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_col</span>(<span style="color:#900;font-weight:bold">aes</span>(start_date, total_steps, fill <span style="color:#000;font-weight:bold">=</span> total_steps), color <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">black&#39;</span>, show.legend <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">FALSE</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_x_discrete</span>(name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">&#39;</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_y_continuous</span>(name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Number of steps&#39;</span>, labels <span style="color:#000;font-weight:bold">=</span> scales<span style="color:#000;font-weight:bold">::</span>comma, expand <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0.01</span>, <span style="color:#099">0</span>)) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_fill_viridis</span>(
    option <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">viridis&#39;</span>, direction <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">-1</span>, na.value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">white&#39;</span>,
    guide <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">guide_colorbar</span>(frame.colour <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">black&#39;</span>, ticks.colour <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">black&#39;</span>)
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme_bw</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme</span>(axis.text.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_text</span>(angle <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">45</span>, hjust <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>))
<span style="color:#900;font-weight:bold">ggsave</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">total_steps_by_day.png&#39;</span>, p, height <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">5</span>, width <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">12</span>)
</code></pre></div>
<figure >
  
    <img src="/images/projects/health_data/total_steps_by_day.png"  style="width: 100%;" />
  
  
</figure>


<h3 id="profile-for-selected-days">Profile for selected days</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r">p <span style="color:#000;font-weight:bold">&lt;-</span> data_steps <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">filter</span>(startDate <span style="color:#000;font-weight:bold">&gt;=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">2020-02-03&#39;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">ggplot</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_rect</span>(
    <span style="color:#900;font-weight:bold">aes</span>(
      xmin <span style="color:#000;font-weight:bold">=</span> start_hour_minute,
      xmax <span style="color:#000;font-weight:bold">=</span> end_hour_minute,
      ymin <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>,
      ymax <span style="color:#000;font-weight:bold">=</span> value,
      fill <span style="color:#000;font-weight:bold">=</span> value
    ),
    show.legend <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">FALSE</span>
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_x_continuous</span>(
    name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Time&#39;</span>, limits <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0</span>,<span style="color:#099">24</span>), breaks <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">seq</span>(<span style="color:#099">0</span>, <span style="color:#099">24</span>, <span style="color:#099">2</span>), expand <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0.01</span>, <span style="color:#099">0</span>)
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_y_continuous</span>(
    name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Number of steps&#39;</span>, labels <span style="color:#000;font-weight:bold">=</span> scales<span style="color:#000;font-weight:bold">::</span>comma, expand <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0.01</span>, <span style="color:#099">0</span>)
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_fill_viridis</span>(
    option <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">viridis&#39;</span>, direction <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">-1</span>, na.value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">white&#39;</span>,
    guide <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">guide_colorbar</span>(frame.colour <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">black&#39;</span>, ticks.colour <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">black&#39;</span>)
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme_bw</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme</span>(strip.text.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_text</span>(face <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">bold&#39;</span>)) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">facet_wrap</span>(<span style="color:#000;font-weight:bold">~</span>start_date, ncol <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">7</span>)
<span style="color:#900;font-weight:bold">ggsave</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">steps_in_time_by_day.png&#39;</span>, p, height <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>, width <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">16</span>)
</code></pre></div>
<figure >
  
    <img src="/images/projects/health_data/steps_in_time_by_day.png"  style="width: 100%;" />
  
  
</figure>


<h3 id="profile-across-all-days">Profile across all days</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r">p <span style="color:#000;font-weight:bold">&lt;-</span> data_steps <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">group_by</span>(start_hour_minute, end_hour_minute) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">summarize</span>(value <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">sum</span>(value)) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">ggplot</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_rect</span>(
    <span style="color:#900;font-weight:bold">aes</span>(
      xmin <span style="color:#000;font-weight:bold">=</span> start_hour_minute,
      xmax <span style="color:#000;font-weight:bold">=</span> end_hour_minute,
      ymin <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>,
      ymax <span style="color:#000;font-weight:bold">=</span> value,
      fill <span style="color:#000;font-weight:bold">=</span> value
    ),
    show.legend <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">FALSE</span>
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_x_continuous</span>(
    name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Time&#39;</span>, limits <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0</span>,<span style="color:#099">24</span>), breaks <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">seq</span>(<span style="color:#099">0</span>, <span style="color:#099">24</span>, <span style="color:#099">1</span>), expand <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0.01</span>,<span style="color:#099">0</span>)
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_y_continuous</span>(
    name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Number of steps&#39;</span>, labels <span style="color:#000;font-weight:bold">=</span> scales<span style="color:#000;font-weight:bold">::</span>comma, expand <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0.01</span>,<span style="color:#099">0</span>)
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_fill_viridis</span>(
    option <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">viridis&#39;</span>, direction <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">-1</span>, na.value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">white&#39;</span>,
    guide <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">guide_colorbar</span>(frame.colour <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">black&#39;</span>, ticks.colour <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">black&#39;</span>)
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme_bw</span>()
<span style="color:#900;font-weight:bold">ggsave</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">steps_in_time_collapsed_by_day.png&#39;</span>, p, height <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">5</span>, width <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">8</span>)
</code></pre></div>
<figure >
  
    <img src="/images/projects/health_data/steps_in_time_collapsed_by_day.png"  style="width: 100%;" />
  
  
</figure>


<h3 id="total-number-of-steps-by-weekday">Total number of steps by weekday</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r">p <span style="color:#000;font-weight:bold">&lt;-</span> data_steps <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">arrange</span>(startDate) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">group_by</span>(start_date) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">summarize</span>(total_steps <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">sum</span>(value)) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">mutate</span>(
    weekday <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">weekdays</span>(<span style="color:#900;font-weight:bold">as.Date</span>(start_date, <span style="color:#d14">&#39;</span><span style="color:#d14">%Y-%m-%d&#39;</span>)),
    weekday <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">factor</span>(weekday, levels <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">Monday&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">Tuesday&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">Wednesday&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">Thursday&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">Friday&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">Saturday&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">Sunday&#39;</span>))
  ) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">ggplot</span>(<span style="color:#900;font-weight:bold">aes</span>(weekday, total_steps)) <span style="color:#000;font-weight:bold">+</span>
  gghalves<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">geom_half_violin</span>(fill <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">grey&#39;</span>, side <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">l&#39;</span>, alpha <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.5</span>) <span style="color:#000;font-weight:bold">+</span>
  gghalves<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">geom_half_boxplot</span>(fill <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">grey&#39;</span>, side <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">r&#39;</span>, outlier.size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>, width <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.5</span>, alpha <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.5</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_jitter</span>(color <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">black&#39;</span>, alpha <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.75</span>, size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_x_discrete</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_y_continuous</span>(name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Number of steps&#39;</span>, labels <span style="color:#000;font-weight:bold">=</span> scales<span style="color:#000;font-weight:bold">::</span>comma) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme_bw</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme</span>(
    legend.position <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">none&#39;</span>,
    axis.title.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
    panel.grid.major.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>()
  )
<span style="color:#900;font-weight:bold">ggsave</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">total_number_of_steps_by_weekday.png&#39;</span>, p, height <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>, width <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">8</span>)
</code></pre></div>
<figure >
  
    <img src="/images/projects/health_data/total_number_of_steps_by_weekday.png"  style="width: 100%;" />
  
  
</figure>


<h3 id="distribution-of-steps-by-weekday">Distribution of steps by weekday</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r">p <span style="color:#000;font-weight:bold">&lt;-</span> data_steps <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">mutate</span>(
    weekday <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">weekdays</span>(<span style="color:#900;font-weight:bold">as.Date</span>(start_date, <span style="color:#d14">&#39;</span><span style="color:#d14">%Y-%m-%d&#39;</span>)),
    weekday <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">factor</span>(weekday, levels <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">Monday&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">Tuesday&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">Wednesday&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">Thursday&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">Friday&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">Saturday&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">Sunday&#39;</span>))
  ) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">group_by</span>(weekday, start_hour_minute, end_hour_minute) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">summarize</span>(value <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">sum</span>(value)) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">ggplot</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_rect</span>(
    <span style="color:#900;font-weight:bold">aes</span>(
      xmin <span style="color:#000;font-weight:bold">=</span> start_hour_minute,
      xmax <span style="color:#000;font-weight:bold">=</span> end_hour_minute,
      ymin <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>,
      ymax <span style="color:#000;font-weight:bold">=</span> value
    ),
    show.legend <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">FALSE</span>
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_x_continuous</span>(
    name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Hour of the day&#39;</span>, limits <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0</span>,<span style="color:#099">24</span>), breaks <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">seq</span>(<span style="color:#099">0</span>, <span style="color:#099">24</span>, <span style="color:#099">2</span>), expand <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0.01</span>,<span style="color:#099">0</span>)
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_y_continuous</span>(
    name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Number of steps&#39;</span>, labels <span style="color:#000;font-weight:bold">=</span> scales<span style="color:#000;font-weight:bold">::</span>comma, expand <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0.01</span>,<span style="color:#099">0</span>)
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme_bw</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme</span>(
    legend.position <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">none&#39;</span>,
    strip.text <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_text</span>(face <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">bold&#39;</span>),
    panel.grid.minor <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),

  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">facet_wrap</span>(<span style="color:#000;font-weight:bold">~</span>weekday, ncol <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>)
<span style="color:#900;font-weight:bold">ggsave</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">step_profile_by_weekday.png&#39;</span>, p, height <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">6</span>, width <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">8</span>)
</code></pre></div>
<figure >
  
    <img src="/images/projects/health_data/step_profile_by_weekday.png"  style="width: 100%;" />
  
  
</figure>


<h2 id="workouts">Workouts</h2>
<h3 id="calendar">Calendar</h3>
<p>To plot highlight the days we worked in calendar style, we take advantage of the <code>ggcal()</code> function made by <a href="https://github.com/jayjacobs/ggcal"><code>jayjaycobs</code></a>.
However, we slightly modify it, e.g. so that the week starts on Monday instead of Sunday.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r">ggcal <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">function</span>(dates, fills) {
  months <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">format</span>(<span style="color:#900;font-weight:bold">seq</span>(<span style="color:#900;font-weight:bold">as.Date</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">2016-01-01&#39;</span>), <span style="color:#900;font-weight:bold">as.Date</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">2016-12-01&#39;</span>), by <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">1 month&#39;</span>), <span style="color:#d14">&#39;</span><span style="color:#d14">%B&#39;</span>)
  mindate <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">as.Date</span>(<span style="color:#900;font-weight:bold">format</span>(<span style="color:#900;font-weight:bold">min</span>(dates), <span style="color:#d14">&#39;</span><span style="color:#d14">%Y-%m-01&#39;</span>))
  maxdate <span style="color:#000;font-weight:bold">&lt;-</span> (<span style="color:#900;font-weight:bold">seq</span>(<span style="color:#900;font-weight:bold">as.Date</span>(<span style="color:#900;font-weight:bold">format</span>(<span style="color:#900;font-weight:bold">max</span>(dates), <span style="color:#d14">&#39;</span><span style="color:#d14">%Y-%m-01&#39;</span>)), length.out <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>, by <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">1 month&#39;</span>) <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span>)[2]
  filler <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">tibble</span>(date <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">seq</span>(mindate, maxdate, by <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">1 day&#39;</span>))
  t1 <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">tibble</span>(date <span style="color:#000;font-weight:bold">=</span> dates, fill <span style="color:#000;font-weight:bold">=</span> fills) <span style="color:#000;font-weight:bold">%&gt;%</span>
    <span style="color:#900;font-weight:bold">right_join</span>(filler, by <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">date&#39;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
    <span style="color:#900;font-weight:bold">mutate</span>(dow <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">as.numeric</span>(<span style="color:#900;font-weight:bold">strftime</span>(<span style="color:#900;font-weight:bold">as.Date</span>(date, <span style="color:#d14">&#39;</span><span style="color:#d14">%Y-%m-%d&#39;</span>), <span style="color:#d14">&#39;</span><span style="color:#d14">%u&#39;</span>))) <span style="color:#000;font-weight:bold">%&gt;%</span>
    <span style="color:#900;font-weight:bold">mutate</span>(month <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">format</span>(date, <span style="color:#d14">&#39;</span><span style="color:#d14">%B&#39;</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>
    <span style="color:#900;font-weight:bold">mutate</span>(woy <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">as.numeric</span>(<span style="color:#900;font-weight:bold">format</span>(date, <span style="color:#d14">&#39;</span><span style="color:#d14">%W&#39;</span>))) <span style="color:#000;font-weight:bold">%&gt;%</span>
    <span style="color:#900;font-weight:bold">mutate</span>(year <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">as.numeric</span>(<span style="color:#900;font-weight:bold">format</span>(date, <span style="color:#d14">&#39;</span><span style="color:#d14">%Y&#39;</span>))) <span style="color:#000;font-weight:bold">%&gt;%</span>
    <span style="color:#900;font-weight:bold">mutate</span>(month <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">factor</span>(month, levels <span style="color:#000;font-weight:bold">=</span> months, ordered <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">TRUE</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>
    <span style="color:#900;font-weight:bold">arrange</span>(year, month) <span style="color:#000;font-weight:bold">%&gt;%</span>
    <span style="color:#900;font-weight:bold">mutate</span>(monlabel <span style="color:#000;font-weight:bold">=</span> month)
  <span style="color:#900;font-weight:bold">if </span>(<span style="color:#900;font-weight:bold">length</span>(<span style="color:#900;font-weight:bold">unique</span>(t1<span style="color:#000;font-weight:bold">$</span>year)) <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">1</span>) {
    t1<span style="color:#000;font-weight:bold">$</span>monlabel <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">paste</span>(t1<span style="color:#000;font-weight:bold">$</span>month, t1<span style="color:#000;font-weight:bold">$</span>year)
  }
  t2 <span style="color:#000;font-weight:bold">&lt;-</span> t1 <span style="color:#000;font-weight:bold">%&gt;%</span>
    <span style="color:#900;font-weight:bold">mutate</span>(monlabel <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">factor</span>(monlabel, ordered <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">TRUE</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>
    <span style="color:#900;font-weight:bold">mutate</span>(monlabel <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">fct_inorder</span>(monlabel)) <span style="color:#000;font-weight:bold">%&gt;%</span>
    <span style="color:#900;font-weight:bold">mutate</span>(monthweek <span style="color:#000;font-weight:bold">=</span> woy <span style="color:#000;font-weight:bold">-</span> <span style="color:#900;font-weight:bold">min</span>(woy), y <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">max</span>(monthweek) <span style="color:#000;font-weight:bold">-</span> monthweek <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>)
  weekdays <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">M&#39;</span>, <span style="color:#d14">&#39;</span><span style="color:#d14">T&#39;</span>, <span style="color:#d14">&#39;</span><span style="color:#d14">W&#39;</span>, <span style="color:#d14">&#39;</span><span style="color:#d14">T&#39;</span>, <span style="color:#d14">&#39;</span><span style="color:#d14">F&#39;</span>, <span style="color:#d14">&#39;</span><span style="color:#d14">S&#39;</span>, <span style="color:#d14">&#39;</span><span style="color:#d14">S&#39;</span>)

  <span style="color:#900;font-weight:bold">if </span>( <span style="color:#900;font-weight:bold">is.numeric</span>(fills) ) {
    fill_scale <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">scale_fill_distiller</span>(palette <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">OrRd&#39;</span>, direction <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>, na.value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">#C8C8C8&#39;</span>)
  } else <span style="color:#900;font-weight:bold">if </span>( <span style="color:#900;font-weight:bold">is.character</span>(fills) <span style="color:#000;font-weight:bold">|</span> <span style="color:#900;font-weight:bold">is.factor</span>(fills) ) {
    fill_scale <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#000;font-weight:bold">NULL</span>
  }

  <span style="color:#900;font-weight:bold">ggplot</span>(t2, <span style="color:#900;font-weight:bold">aes</span>(dow, y, fill <span style="color:#000;font-weight:bold">=</span> fill)) <span style="color:#000;font-weight:bold">+</span>
    <span style="color:#900;font-weight:bold">geom_tile</span>(color <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">#505050&#39;</span>, show.legend <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">FALSE</span>) <span style="color:#000;font-weight:bold">+</span>
    <span style="color:#900;font-weight:bold">facet_wrap</span>(<span style="color:#000;font-weight:bold">~</span>monlabel, ncol <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>, scales <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">free&#39;</span>) <span style="color:#000;font-weight:bold">+</span>
    <span style="color:#900;font-weight:bold">scale_x_continuous</span>(expand <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0</span>, <span style="color:#099">0</span>), position <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">top&#39;</span>, breaks <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">seq</span>(<span style="color:#099">1</span>, <span style="color:#099">7</span>), labels <span style="color:#000;font-weight:bold">=</span> weekdays) <span style="color:#000;font-weight:bold">+</span>
    <span style="color:#900;font-weight:bold">scale_y_continuous</span>(expand <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0</span>, <span style="color:#099">0</span>)) <span style="color:#000;font-weight:bold">+</span>
    fill_scale <span style="color:#000;font-weight:bold">+</span>
    <span style="color:#900;font-weight:bold">theme</span>(
      panel.background <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_rect</span>(fill <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">NA</span>, color <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">NA</span>),
      strip.background <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_rect</span>(fill <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">NA</span>, color <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">NA</span>),
      strip.text.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_text</span>(hjust <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>, face <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">bold&#39;</span>),
      legend.title <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
      axis.ticks <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
      axis.title <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
      axis.text.y <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
      strip.placement <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">outside&#39;</span>
    )
}

p <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">ggcal</span>(
  workouts<span style="color:#000;font-weight:bold">$</span>starting_time <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">as.Date</span>(),
  workouts <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(length <span style="color:#000;font-weight:bold">=</span> finishing_time <span style="color:#000;font-weight:bold">-</span> starting_time) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">pull</span>(length) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">as.numeric</span>()
)
<span style="color:#900;font-weight:bold">ggsave</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">workouts_calendar.png&#39;</span>, p, height <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4.5</span>, width <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">8</span>)
</code></pre></div>
<figure >
  
    <img src="/images/projects/health_data/workouts_calendar.png"  style="width: 100%;" />
  
  
</figure>


<p>Color reflects the workout length.</p>
<h2 id="running-sessions">Running sessions</h2>
<p><strong>WORK IN PROGRESS</strong></p>
<p>I took parts of code from this article: <a href="https://rpubs.com/ials2un/gpx1">https://rpubs.com/ials2un/gpx1</a></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-r" data-lang="r"><span style="color:#900;font-weight:bold">library</span>(ggmap)
<span style="color:#900;font-weight:bold">library</span>(plotKML)
<span style="color:#900;font-weight:bold">library</span>(geosphere)

gpx_file <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">readGPX</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">runs/2020-02-16.gpx&#39;</span>)

df <span style="color:#000;font-weight:bold">&lt;-</span> gpx_file<span style="color:#000;font-weight:bold">$</span>tracks[[1]][[1]] <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">mutate</span>(time <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">as.POSIXct</span>(time, format <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;</span><span style="color:#d14">%Y-%m-%dT%H:%M:%OSZ&#34;</span>)))

<span style="color:#900;font-weight:bold">for </span>( i in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>(<span style="color:#900;font-weight:bold">nrow</span>(df)<span style="color:#099">-1</span>)) {
  df<span style="color:#000;font-weight:bold">$</span>distance[i] <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">distm</span>(
    <span style="color:#900;font-weight:bold">c</span>(df<span style="color:#000;font-weight:bold">$</span>lon[i], df<span style="color:#000;font-weight:bold">$</span>lat[i]), <span style="color:#900;font-weight:bold">c</span>(df<span style="color:#000;font-weight:bold">$</span>lon[i<span style="color:#099">+1</span>], df<span style="color:#000;font-weight:bold">$</span>lat[i<span style="color:#099">+1</span>]), fun <span style="color:#000;font-weight:bold">=</span> distHaversine
  )
  df<span style="color:#000;font-weight:bold">$</span>speed[i] <span style="color:#000;font-weight:bold">&lt;-</span> ( df<span style="color:#000;font-weight:bold">$</span>distance[i] <span style="color:#000;font-weight:bold">/</span> <span style="color:#900;font-weight:bold">as.numeric</span>(<span style="color:#900;font-weight:bold">difftime</span>(df<span style="color:#000;font-weight:bold">$</span>time[i<span style="color:#099">+1</span>], df<span style="color:#000;font-weight:bold">$</span>time[i], units <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">secs&#39;</span>)) ) <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">3.6</span>
}

<span style="color:#900;font-weight:bold">ggplot</span>(df) <span style="color:#000;font-weight:bold">+</span>
<span style="color:#900;font-weight:bold">geom_point</span>(<span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> time, y <span style="color:#000;font-weight:bold">=</span> speed, color <span style="color:#000;font-weight:bold">=</span> speed)) <span style="color:#000;font-weight:bold">+</span>
<span style="color:#900;font-weight:bold">geom_smooth</span>(<span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> time, y <span style="color:#000;font-weight:bold">=</span> speed), color <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">black&#39;</span>, method <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">loess&#39;</span>, size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>, span <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>) <span style="color:#000;font-weight:bold">+</span>
<span style="color:#900;font-weight:bold">scale_color_distiller</span>(
  name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Speed&#39;</span>,
  palette <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">Spectral&#39;</span>,
  direction <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>,
  limits <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">min</span>(df<span style="color:#000;font-weight:bold">$</span>speed), <span style="color:#900;font-weight:bold">quantile</span>(df<span style="color:#000;font-weight:bold">$</span>speed, probs <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.95</span>)),
  oob <span style="color:#000;font-weight:bold">=</span> scales<span style="color:#000;font-weight:bold">::</span>squish,
  guide <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">guide_colorbar</span>(frame.colour <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">black&#39;</span>, ticks.colour <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">black&#39;</span>)
) <span style="color:#000;font-weight:bold">+</span>
<span style="color:#900;font-weight:bold">theme_bw</span>()

map_of_Milan <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">get_stamenmap</span>(bbox <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(left <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">9.146976</span>, bottom <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">45.438092</span>, right <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">9.229717</span>, top <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">45.490344</span>), zoom <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">14</span>, maptype <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;</span><span style="color:#d14">toner-lines&#34;</span>)

<span style="color:#900;font-weight:bold">ggmap</span>(map_of_Milan) <span style="color:#000;font-weight:bold">+</span>
<span style="color:#900;font-weight:bold">geom_point</span>(data <span style="color:#000;font-weight:bold">=</span> df, <span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> lon, y <span style="color:#000;font-weight:bold">=</span> lat, color <span style="color:#000;font-weight:bold">=</span> speed), size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>) <span style="color:#000;font-weight:bold">+</span>
<span style="color:#900;font-weight:bold">theme_bw</span>() <span style="color:#000;font-weight:bold">+</span>
<span style="color:#900;font-weight:bold">theme</span>(
  axis.line <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
  axis.text.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
  axis.text.y <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
  axis.ticks <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
  axis.title.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
  axis.title.y <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
  panel.background <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
  panel.border <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
  panel.grid.major <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
  panel.grid.minor <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
  plot.background <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>()
)

df
</code></pre></div><h2 id="to-do">To do</h2>
<ul>
<li>Sleep
<ul>
<li>Handle sleep blocks over 18:00.</li>
<li>Merge adjacent sleep blocks.</li>
</ul>
</li>
<li>Steps
<ul>
<li>Profile of steps over time, accumulated and colored by day.</li>
</ul>
</li>
<li>Running sessions
<ul>
<li>Add chapter.</li>
</ul>
</li>
<li>More
<ul>
<li>Correlate steps with heart rate.</li>
<li>Summaries by day of the week.</li>
</ul>
</li>
</ul>

            </div>
        </body>
        </div>
      </div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="/js/fold_code_boxes.js"></script>
  <script src="/js/line_under_header.js"></script>

      </div>
<footer class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-4 col-sm-4 text-center text-lg-left">
        &copy; Copyright Roman Hillje - All rights reserved
      </div>
      <section class="col-md-4 col-sm-4 text-center">
        <a target="_blank" href="https://www.twitter.com/fakechek1"><i class="fab fa-twitter" style="color: rgba(0,0,0,.44); font-size: 2rem; margin-left: 10px" aria-hidden="true"></i></a>
        <a target="_blank" href="https://github.com/romanhaa"><i class="fab fa-github" style="color: rgba(0,0,0,.44); font-size: 2rem; margin-left: 10px" aria-hidden="true"></i></a>
        <a target="_blank" href="https://gitlab.com/romanhaa"><i class="fab fa-gitlab" style="color: rgba(0,0,0,.44); font-size: 2rem; margin-left: 10px" aria-hidden="true"></i></a>
        <a target="_blank" href="https://linkedin.com/in/roman.hillje"><i class="fab fa-linkedin" style="color: rgba(0,0,0,.44); font-size: 2rem; margin-left: 10px" aria-hidden="true"></i></a>
      </section>
      <div class="col-md-4 col-sm-4 text-center text-lg-right">
        Adapted from <a target="_blank" href="https://www.wowthemes.net">Mediumish Theme</a>
      </div>
    </div>
  </div>
</footer>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<script src="/js/mediumish.js"></script>
<script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script>
<script src="/js/toc.js"></script>

  </body>
</html>
